d: #ef4444;
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }

        .timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #ef4444;
        }

        .section {
            background: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .transcript-box, .summary-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            min-height: 150px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
            color: #374151;
        }

        .transcript-box:empty::before {
            content: "Nh·∫•n n√∫t Ghi √Çm ƒë·ªÉ b·∫Øt ƒë·∫ßu...";
            color: #9ca3af;
        }

        .summary-box:empty::before {
            content: "B·∫£n t√≥m t·∫Øt s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y...";
            color: #9ca3af;
        }

        .summary-item {
            padding: 10px;
            margin: 5px 0;
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            border-radius: 5px;
        }

        .timestamp {
            color: #6b7280;
            font-size: 0.85em;
            margin-right: 10px;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .info-box strong {
            color: #1e40af;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .control-panel {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéôÔ∏è Ghi √Çm Cu·ªôc H·ªçp</h1>
            <p>Ghi √¢m v√† t√≥m t·∫Øt c√°c ƒëi·ªÉm quan tr·ªçng t·ª± ƒë·ªông</p>
        </div>

        <div class="content">
            <div class="info-box">
                <strong>üìå H∆∞·ªõng d·∫´n:</strong> Nh·∫•n "B·∫Øt ƒê·∫ßu Ghi √Çm" ƒë·ªÉ ghi l·∫°i cu·ªôc h·ªçp. Khi k·∫øt th√∫c, nh·∫•n "D·ª´ng" v√† sau ƒë√≥ "T√≥m T·∫Øt" ƒë·ªÉ xem c√°c ƒëi·ªÉm quan tr·ªçng.
            </div>

            <div class="recording-indicator" id="recordingIndicator">
                <div class="pulse"></div>
                <span>ƒêang ghi √¢m...</span>
                <span class="timer" id="timer">00:00</span>
            </div>

            <div class="control-panel">
                <button class="btn btn-record" id="recordBtn" onclick="startRecording()">
                    ‚è∫Ô∏è B·∫Øt ƒê·∫ßu Ghi √Çm
                </button>
                <button class="btn btn-stop" id="stopBtn" onclick="stopRecording()" disabled>
                    ‚èπÔ∏è D·ª´ng
                </button>
                <button class="btn btn-clear" onclick="clearAll()">
                    üóëÔ∏è X√≥a T·∫•t C·∫£
                </button>
                <button class="btn btn-summarize" id="summarizeBtn" onclick="summarizeContent()" disabled>
                    ‚ú® T√≥m T·∫Øt
                </button>
                <button class="btn btn-download" id="downloadBtn" onclick="downloadTranscript()" disabled>
                    üíæ T·∫£i Xu·ªëng
                </button>
            </div>

            <div class="section">
                <h2>üìù N·ªôi Dung Ghi √Çm</h2>
                <div class="transcript-box" id="transcript" contenteditable="true"></div>
            </div>

            <div class="section">
                <h2>‚≠ê T√≥m T·∫Øt C√°c ƒêi·ªÉm Quan Tr·ªçng</h2>
                <div class="summary-box" id="summary"></div>
            </div>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let recognition;
        let isRecording = false;
        let startTime;
        let timerInterval;
        let fullTranscript = '';

        // Kh·ªüi t·∫°o Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'vi-VN';

                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    if (finalTranscript) {
                        const timestamp = new Date().toLocaleTimeString('vi-VN');
                        fullTranscript += finalTranscript;
                        const transcriptDiv = document.getElementById('transcript');
                        transcriptDiv.innerHTML += `<span class="timestamp">[${timestamp}]</span>${finalTranscript}<br>`;
                        transcriptDiv.scrollTop = transcriptDiv.scrollHeight;
                    }
                };

                recognition.onerror = function(event) {
                    console.error('L·ªói nh·∫≠n d·∫°ng gi·ªçng n√≥i:', event.error);
                    if (event.error === 'no-speech') {
                        // Ti·∫øp t·ª•c l·∫Øng nghe
                        if (isRecording) {
                            recognition.start();
                        }
                    }
                };

                recognition.onend = function() {
                    if (isRecording) {
                        recognition.start();
                    }
                };

                return true;
            } else {
                alert('‚ö†Ô∏è Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ nh·∫≠n d·∫°ng gi·ªçng n√≥i. Vui l√≤ng s·ª≠ d·ª•ng Google Chrome ho·∫∑c Microsoft Edge.');
                return false;
            }
        }

        async function startRecording() {
            try {
                // Kh·ªüi t·∫°o Speech Recognition
                if (!recognition && !initSpeechRecognition()) {
                    return;
                }

                // Y√™u c·∫ßu quy·ªÅn truy c·∫≠p microphone
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // B·∫Øt ƒë·∫ßu ghi √¢m
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.start();
                recognition.start();
                isRecording = true;

                // C·∫≠p nh·∫≠t UI
                document.getElementById('recordBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('recordingIndicator').classList.add('active');

                // B·∫Øt ƒë·∫ßu ƒë·∫øm th·ªùi gian
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);

            } catch (error) {
                alert('‚ùå Kh√¥ng th·ªÉ truy c·∫≠p microphone. Vui l√≤ng cho ph√©p truy c·∫≠p microphone.');
                console.error('L·ªói:', error);
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }

            if (recognition) {
                recognition.stop();
            }

            isRecording = false;
            clearInterval(timerInterval);

            // C·∫≠p nh·∫≠t UI
            document.getElementById('recordBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('recordingIndicator').classList.remove('active');
            document.getElementById('summarizeBtn').disabled = false;
            document.getElementById('downloadBtn').disabled = false;
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function clearAll() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ n·ªôi dung?')) {
                document.getElementById('transcript').innerHTML = '';
                document.getElementById('summary').innerHTML = '';
                fullTranscript = '';
                document.getElementById('summarizeBtn').disabled = true;
                document.getElementById('downloadBtn').disabled = true;
            }
        }

        function summarizeContent() {
            const transcriptText = document.getElementById('transcript').innerText || fullTranscript;
            
            if (!transcriptText.trim()) {
                alert('‚ö†Ô∏è Ch∆∞a c√≥ n·ªôi dung ƒë·ªÉ t√≥m t·∫Øt!');
                return;
            }

            const summaryDiv = document.getElementById('summary');
            summaryDiv.innerHTML = '<p style="color: #6b7280;">ƒêang ph√¢n t√≠ch v√† t√≥m t·∫Øt...</p>';

            // Thu·∫≠t to√°n t√≥m t·∫Øt ƒë∆°n gi·∫£n d·ª±a tr√™n t·ª´ kh√≥a
            setTimeout(() => {
                const summary = generateSummary(transcriptText);
                summaryDiv.innerHTML = summary;
            }, 1000);
        }

        function generateSummary(text) {
            // T√°ch c√¢u
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
            
            // T·ª´ kh√≥a quan tr·ªçng (ti·∫øng Vi·ªát)
            const keywords = [
                'quan tr·ªçng', 'c·∫ßn', 'ph·∫£i', 's·∫Ω', 'd·ª± √°n', 'k·∫ø ho·∫°ch', 
                'm·ª•c ti√™u', 'deadline', 'ho√†n th√†nh', 'b√°o c√°o', 'quy·∫øt ƒë·ªãnh',
                'th·∫£o lu·∫≠n', 'ƒë·ªÅ xu·∫•t', 'th·ªëng nh·∫•t', 'c√¥ng vi·ªác', 'nhi·ªám v·ª•',
                'ng√†y', 'tu·∫ßn', 'th√°ng', 's·ªë', 'ph·∫ßn trƒÉm', '%', 'tri·ªáu', 't·ª∑'
            ];

            let summary = '';
            let importantSentences = [];

            // T√¨m c√¢u ch·ª©a t·ª´ kh√≥a
            sentences.forEach((sentence, index) => {
                const lowerSentence = sentence.toLowerCase();
                const keywordCount = keywords.filter(keyword => 
                    lowerSentence.includes(keyword)
                ).length;

                if (keywordCount > 0) {
                    importantSentences.push({
                        text: sentence.trim(),
                        score: keywordCount,
                        index: index
                    });
                }
            });

            // S·∫Øp x·∫øp theo ƒëi·ªÉm
            importantSentences.sort((a, b) => b.score - a.score);

            // L·∫•y top 5 c√¢u quan tr·ªçng nh·∫•t
            const topSentences = importantSentences.slice(0, 5);

            if (topSentences.length === 0) {
                // N·∫øu kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a, l·∫•y c√°c c√¢u ƒë·∫ßu v√† cu·ªëi
                summary = '<div class="summary-item">üìå <strong>ƒêi·ªÉm 1:</strong> ' + sentences[0] + '</div>';
                if (sentences.length > 1) {
                    summary += '<div class="summary-item">üìå <strong>ƒêi·ªÉm 2:</strong> ' + sentences[sentences.length - 1] + '</div>';
                }
            } else {
                topSentences.forEach((item, index) => {
                    summary += `<div class="summary-item">üìå <strong>ƒêi·ªÉm ${index + 1}:</strong> ${item.text}</div>`;
                });
            }

            // Th√™m th·ªëng k√™
            const wordCount = text.split(/\s+/).length;
            summary += `<div style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                <strong>üìä Th·ªëng k√™:</strong><br>
                ‚Ä¢ T·ªïng s·ªë t·ª´: ${wordCount}<br>
                ‚Ä¢ S·ªë c√¢u: ${sentences.length}<br>
                ‚Ä¢ ƒêi·ªÉm quan tr·ªçng: ${topSentences.length}
            </div>`;

            return summary;
        }

        function downloadTranscript() {
            const transcriptText = document.getElementById('transcript').innerText;
            const summaryText = document.getElementById('summary').innerText;
            
            const content = `GHI √ÇM CU·ªòC H·ªåP
Ng√†y: ${new Date().toLocaleDateString('vi-VN')}
Th·ªùi gian: ${new Date().toLocaleTimeString('vi-VN')}

========================================
N·ªòI DUNG GHI √ÇM
========================================
${transcriptText}

========================================
T√ìM T·∫ÆT C√ÅC ƒêI·ªÇM QUAN TR·ªåNG
========================================
${summaryText}
`;

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cuoc-hop-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Ki·ªÉm tra h·ªó tr·ª£ khi t·∫£i trang
        window.onload = function() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('‚ö†Ô∏è Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ghi √¢m. Vui l√≤ng s·ª≠ d·ª•ng tr√¨nh duy·ªát hi·ªán ƒë·∫°i nh∆∞ Chrome, Edge, ho·∫∑c Firefox.');
            }
        };
    </script>
</body>
</html>
